# Week 7-2: How to review code effectively: A GitHub staff engineer’s philosophy
# 如何高效审查代码：一位 GitHub Staff 工程师的哲学

> **Original Link**: [https://github.blog/developer-skills/github/how-to-review-code-effectively-a-github-staff-engineers-philosophy/](https://github.blog/developer-skills/github/how-to-review-code-effectively-a-github-staff-engineers-philosophy/)
> **Title**: How to review code effectively: A GitHub staff engineer’s philosophy
> **Author**: Sarah Vessels
> **Week**: 7
> **Reading Time**: 15 min
> **Priority**: High
> **Translation Date**: 2026-02-03

---

GitHub Staff 工程师 Sarah Vessels 探讨了她的代码审查哲学，区分好坏代码审查的要素，她发现和审查代码的策略，以及如何从对自己代码的审查中获得最大收益。

作为 GitHub 的一名 Staff 工程师，代码审查是我日常工作的重点领域之一。在过去的八年里，我审查了超过 7,000 个拉取请求（Pull Requests）。为什么这么多？因为代码审查对于构建优秀的软件至关重要，另一双眼睛往往能发现你原本会错过的每一个问题。

我认为代码审查是我工作中最重要的一面。事实上，每当我看到队友有一个准备好接受代码审查的 PR 时，我更愿意放下手头正在进行的分支，转而去审查他们提议的变更。毕竟，他们的 PR 已经通过了持续集成（CI）的考验，并且达到了他们自己判断的“完成”标准，所以它可能比我自己正在进行的工作更接近可发布状态。我宁愿帮助他们的代码跨过终点线，也不愿再花未知的时间去完成我自己的代码。

我越早提供反馈——“这可能是 nil 并导致错误”、“这看起来像是一个 n+1 查询”、“在这个上面加个方法签名会很好”——这些反馈就能越快得到解决，bug 就能被消灭，特性就能被发布。

我想分享我是如何进行代码审查的，希望我们都能发布更好的代码。

## 什么是代码审查？

严格来说，代码审查——通过 GitHub 上的 [拉取请求审查](https://docs.github.com/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews)——允许协作者对 PR 中提议的变更进行评论，表示对变更的批准，或在 PR 合并前要求进一步的变更。

我将 PR 视为对话的开始。我把它读作作者在说：“我认为这改进了我们需要的东西。” 代码审查是塑造产品实现的绝佳机会。作为代码审查者，我的工作是与作者反复讨论，通过提问、质疑假设，并作为第二双眼睛来改进他们的代码。

### 为什么审查代码？这对你的职业生涯有好处

我从其他审查者对我自己代码的看法中学到了很多，在收到多次感谢我及时代码审查的积极反馈后，我知道我的代码审查评论同样帮助提升了我的队友。简而言之，代码审查具有影响力，而获得晋升需要展示你的影响力。

代码审查之所以有影响力，是因为它们有助于知识交流并提高发布速度。它们是很好的、可链接的工件，同行和经理可以用它们来展示你是多么乐于助人和知识渊博。它们可以突显良好的沟通技巧，特别是如果需要进行复杂或有争议的变更时。因此，在代码审查中充分阐述你的观点不仅可以指导产品的未来并帮助避免事故，这对你的职业生涯也有好处。

## 微调你的代码审查流程

### 如何找到需要审查的 PR

我生活在我的 [GitHub 通知收件箱](https://github.com/notifications?query=is:unread) 中。这是我在浏览器中固定的少数几个标签页之一，即使它总是可用的。每当我等待 CI，在任务之间，开始新的一天，或者通常有空闲时刻时，我都喜欢检查我的收件箱。我在那里发现了大部分我也审查的 PR。GitHub 的团队倾向于拥有一个特定的 Slack 频道作为大本营，这也是分享准备好审查的 PR 的好地方——这是我发现 PR 的另一个主要方式。

我也很幸运地使用 [GitHub Slack 集成](https://slack.github.com/) 订阅 Slack 频道，以获取与我的团队相关的特定 PR。为了过滤哪些 PR 显示在 Slack 中，我使用特定于团队的标签，然后使用 Slack 中的 `subscribe` 命令，如 `/github subscribe your/repo pulls +label:"your-team-label"`。

```
/github subscribe your/repo pulls +label:"your-team-label"
```

> **Tip**: 你可以在查询中重复 `team-review-requested:` 限定符，以获取跨许多不同代码所有者的审查请求。

我也喜欢搜索可能需要审查的未完成 PR，使用的查询类似于 `is:open archived:false is:pr org:github -is:draft team-review-requested:github/relevant-codeowner-team`。通过该查询，我可以找到 GitHub 组织内开放的、未归档的 PR，这些 PR 不是草稿，并且已请求相关代码所有者团队进行审查。我通常会省略 `review:required` 搜索限定符，因为即使队友已经审查过，我也对审查 PR 感兴趣。毕竟，审查代码不仅有助于作者，也有助于我了解我负责的代码所受的影响。

```
is:open archived:false is:pr org:github -is:draft team-review-requested:github/relevant-codeowner-team
```

### 使用审查者团队来管理通知

你不希望代码变更去 ping 一个如此大的团队，以至于团队中的每个人都认为审查变更不是他们的 [责任](https://en.wikipedia.org/wiki/Diffusion_of_responsibility)（责任分散）。这可能导致 PR 要么被搁置未审，要么在不该合并时被合并，因为关键审查者在大量的通知中错过了它们。这两种情况都会影响产品的质量。

我建议如果可能的话，精简你所在的 [代码所有者 (code owner)](https://docs.github.com/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners) 团队的数量，以保持通知的可管理性。这样，落入你收件箱的 PR 就不再只是噪音，而是你真正觉得应该审查的东西。虽然大的、包罗万象的代码所有者团队作为备用选项是可以的，但它们作为自动审查请求的第一线默认设置并不好。保持你的仓库的 CODEOWNERS 文件组织良好，并伴随明确定义的代码边界，以限制通知并帮助审查者避免通知疲劳。

另一种限制基于团队的通知的方法是创建一个“第一响应者”团队，然后使用自动化根据时间表添加和移除团队成员。这可以让你的团队专注于他们日常的代码库，而预定的第一响应者则会收到你团队服务领域内 PR 的通知。例如，使用 [PagerDuty API](https://developer.pagerduty.com/api-reference/3f03afb2c84a4-get-a-schedule)，你可以确定某一天谁是第一响应者。然后你可以使用 [Octokit 库](https://docs.github.com/rest/using-the-rest-api/libraries-for-the-rest-api?apiVersion=2022-11-28#official-github-libraries) 来添加和移除团队成员。

### 通过自动化标准化跨团队的代码审查

仓库级配置和自动化，例如使用 [CODEOWNERS 文件](https://docs.github.com/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners#codeowners-file-location) 和 [分支保护规则](https://docs.github.com/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/managing-a-branch-protection-rule)，有助于在团队之间强制执行审查流程标准。其他标准，例如在 PR 中什么值得评论，必须由我们人类来维护。记录代码审查在你团队中的工作方式，以确保任何提供代码审查或提交 PR 的人都知道如何让他们的 PR 被审查，预期的审查周转时间，以及用于促进审查的自动化。

一些团队使用项目板来跟踪哪些 PR 进来审查；我见过这对管理共享 API 的团队很有效，因为这是一个经常由团队以外的人修改的领域。其他团队仅依赖 GitHub 通知，我见过这在代码所有权范围严格且团队纪律严明地审查进来的 PR 时也很有效。

如果你遵循特定于你团队的独特流程，自动化可以帮助通过团队以外的人沟通期望。例如，如果许多其他团队依赖你团队的审查，你可以使用机器人自动在任何请求你团队审查的 PR 上留下评论，告诉作者什么时候可以期待收到你们的回复。

## 什么是好的或坏的代码审查？

**好的代码审查能增加清晰度，并将代码推向比开始时更好的状态。**

作为审查者，沟通的清晰度是关键。你要明确你的哪些评论是个人偏好，哪些是批准的阻碍因素。提供一个你建议的方法的例子来提升你的代码审查，并使你的意思更清楚。如果你能从与 PR 相同的仓库中提供一个例子，那就更好了——通过鼓励一致的实现，这进一步支持了你的建议。

相比之下，糟糕的代码审查缺乏清晰度。例如，没有任何评论的全面批准或拒绝会让 PR 作者怀疑审查是否彻底。即使只是重申你对 PR 作者意图的理解并表示批准，也能揭示你和作者是否有相同的理解。

一个关于其建议应何时实施不明确的代码审查也可能给作者带来糟糕的体验。指出即有的、未更改的代码应该重构，或者应该处理额外的情况是可以的，但这很重要：要说明这些是否是批准的前提条件。如果 PR 在没有你的建议的情况下可以落地，请务必说明。保持小的 diff 并单独发布那些更改作为单独的 PR 可能会更安全。

这是一个显示具体性并清楚传达建议实现的代码审查评论：

> “我看到你的新方法与此文件中的现有风格相匹配，采用了 [X] 个参数。拥有这么多参数会损害可读性，并暗示该函数做得太多。你觉得在稍后的 PR 中重构此方法和现有方法以减少它们采用的参数数量怎么样？”

这条评论做得好的地方：
- 提供了具体的细节。
- 引用了特定的代码或问题。
- 建议了问题的解决方案。
- 引用了证据或提供了解释。

在光谱的另一端，这里有一些可以改进的审查评论示例：

**“我不喜欢这个。”** – 审查者不喜欢什么？他们有心中的替代方案可以明确陈述吗？
可能的改进：
- “这一行做的事情太多了，我们可以简化它以提高可读性吗？”
- “我认为这会有性能问题，因为存在 n+1 查询。”
- “我们能不能使用 [首选框架] 的解决方案来代替编写自定义实现？”

**“这行不通。”** – 为什么更改行不通？
可能的改进：
- “这行不通，因为 [X]，请参阅此相关 issue：[issue 链接]。”
- “这在 [PR 链接] 中之前尝试过，之所以行不通是因为 [X]。”
- “如果你遇到 [X] 的问题，你可以尝试 [替代方法]。”

**“我认为这修复了一个 bug。”** – 我喜欢这个呼吁，但有没有额外的上下文，比如 issue 链接，可以使这更清楚？
可能的改进：
- “我认为这修复了 [issue 链接]。”
- “这是在修复 [issue 链接] 中的 bug 吗？”
- “这看起来像是我们在 [失败构建链接] 中遇到的 bug。感谢修复！”

## 如何给出好的代码审查

### 提问

我认为 PR 作者是对其 PR 所做更改拥有最多背景信息的人。我可以根据我的历史——我在 Ruby on Rails 单体应用、Typescript 或高流量数据库中的工作经验——指出我看到的问题，但我相信作者对我问题的回答。我认为他们对细节的理解比我好。

> **Tip**: 如果你是代码库或团队的新手，请在代码审查中提问，以了解技术栈以及有哪些内部工具和库可用。你审查的每个 PR 都是了解作者为什么偏爱一种方法而不是另一种方法的机会。

我也喜欢问涉及代码中所做假设的问题。他们正在处理的数据的形状是什么？是否存在不匹配该形状的数据？代码对此反应良好吗？代码是资源密集型的吗？它的性能会好吗？作为审查者，我最喜欢的回应是作者提供一个自动测试，验证在这些场景下的行为。我第二喜欢的回应是经验数据，例如来自我们需要仓库的查询或 Datadog 图表，显示为什么这些场景不是问题。

作为 PR 作者，我感激收到问题。当有人提问时，它为我解释为什么我对我的更改有信心腾出了空间，必要时引用 issue、查询或图表。这也让我可以与他人分享我的知识和经验。作者不仅能看到我的回应，其他审查者和未来可能在过去的决策中寻找上下文的读者也能看到。

### 提供肯定

除了提问，评论 PR 中你同意的部分也是好习惯。这些评论可以强调你阅读并理解了正在更改的内容，或者你验证了代码中的某些假设。这里有一些例子：
- “看起来这与此模块中其他类使用的模式相匹配。”
- “感谢为这个添加测试！”
- “这比以前可读性强多了。”

根据我的经验，作为接收端收到这样的评论也很不错。接受代码审查有时会让人感到筋疲力尽。当我正在处理来自多方的提问和建议时，得到一些不要求我做任何事、而是支持和认可我已经投入工作的评论，这会是一个很好的鼓励。

### 意识到偏见和假设

很容易让你对审查者或他们正在更改的代码区域的偏见影响你的审查。你习惯了某人在某个领域工作或拥有某种资历，并假设他们知道自己在做什么——但每个人都会犯错。你对他们更改的关注，你检查他们假设或验证你自己假设的问题，可以在部署之前发现问题。

我很推崇编写测试，因为它们消除了部分偏见。当你编写测试来检查代码是否正常工作时，[你不需要听作者的一面之词](https://www.youtube.com/watch?v=NIKAsGC1Iy8)，你只需要看测试是否通过——当然，前提是你把测试写对了。😅

我也很推崇初级开发者在代码审查中向高级开发者提问，即使他们认为他们的问题很傻或有明显的答案。如果这对你不明显，那是合理的。对别人来说也不会明显！提出问题，为作者写下他们的答案腾出空间，并为后来者保留那一点教育。

### 批准与否

此时我看做是一个阻挡门，可以阻止另一个人改进我们的产品，所以我认真地保留批准。我经常会有个人偏好并建议我希望作者做出的可选更改，但我不会仅基于这些而保留批准。如果我对某人的 PR 有建议，但他们的 PR 原样不会破坏生产环境、对用户产生负面影响或以其他方式导致问题，我会在批准时附带这些评论。作者可以选择在合并他们的 PR 之前解决我的反馈，或者他们可以在另一个分支中跟进。

> **Tip**: 使用 [特性标志 (feature flags)](https://github.com/flippercloud/flipper) 并使你的 PR 变小。你的更改越不吓人，它在生产中被逆转得越快，我就越容易批准它！

在审查代码时请记住你建议的重要性。为了让你的建议得到解决而推迟发布值得吗？值得作者看到你的反馈、做出建议的更改、等待 CI、重新审查、部署并最终合并的整个周期吗？如果一个建议的缺失不会让某人的一天变得更糟，让作者决定是否或何时做出建议的更改。

[‘Request changes’ 选项](https://docs.github.com/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/reviewing-proposed-changes-in-a-pull-request#submitting-your-review) 会阻止 PR 合并，直到审查者回来并批准它。我很少使用它，因为它通常感觉太严厉了。我相信我的团队知道何时批准 PR，所以队友的批准可以代替我的。同样，我相信 PR 作者尊重我的反馈并考虑它，而不仅仅是因为其他人批准了我没批准就盲目合并。我唯一选择 ‘Request changes’ 选项的时候是当我认为存在直接的安全问题，并且我担心他们在合并之前看不到我的担忧时。

> **为什么在使用 AI 编码工具时代码审查很重要**
> AI 编码工具通常包含各种防止不正确或不安全代码的保障措施，但不要陷入虚假的安全感。作为掌舵的人类审查者，你是最后一道防线，应该以同等程度的勤奋审查所有代码。

## 如何从代码审查中获得最大收益

### 审查你自己的代码

GitHub 高级软件工程师 [Paul Smith](https://github.com/paulcsmith) 教会在请别人审查之前先审查我自己的 PR，我建议你也这样做。过一遍并在不明显的更改或如果在别人的 PR 中看到你会问的地方留下内联评论。自我审查也可以帮助确定 PR 是否太大，是否受益于 [被拆分](https://github.blog/2020-05-21-github-protips-tips-tricks-hacks-and-secrets-from-sarah-vessels/)。

> **Shout-out**: 如果你关心保持你的 PR 小，你可以使用 [lerebear/sizeup-action](https://github.com/lerebear/sizeup-action) 来自动给 PR 打标签，表明它们的复杂性和大小。

### 欢迎合并后的审查

如果我碰巧在有人有机会审查之前合并了一个 PR，我仍然欢迎他们的审查。如果我的 PR 破坏了某些东西或产生了意想不到的后果，在这个 PR 上评论就像留下了面包屑路径，帮助未来的读者追踪发生了什么！

如果我在合并后的 PR 上收到审查，我会像 PR 落地之前一样处理反馈。也许那会是一个解释我观点的评论，也许会是额外的 PR 来迭代我最初发布的代码。也许会是打开新的 issue 来捕捉需要完成的额外工作。

### 使用草稿 PR

当你创建一个新的 PR 时，你可以选择将 PR 设置为草稿。我非常依赖 [草稿阶段](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/changing-the-stage-of-a-pull-request) 来表明我是否想要审查。例如，如果所需的 CI 构建失败了或者我还没完成，我会保持它为草稿。我倾向于对别人的 PR 也有同样的期望：如果是草稿，我假设作者还没准备好接受审查。如果它被标记为准备好审查，我假设获得足够的批准是阻止他们部署 PR 的唯一原因。

草稿状态意味 PR 尚未完成，所以当解决合并冲突或处理审查者反馈时，我会把 PR 移回草稿。如果我必须修改代码，我会先把我的 PR 标记为草稿，以免让已经审查过的人感到不知所措。当我把它移回“准备好”时，它会向那些审查者发送 GitHub 通知，以便他们可以再次查看。

### 保持友善 (Be gracious)

我想到了“用蜂蜜比用醋能抓到更多苍蝇”这句谚语。我想要对我的 PR 进行审查，所以我喜欢回复我的 PR 上的评论——特别是如果我不同意审查者的观点。即使我不回复审查评论，我通常也会用 👍 做出反应表示我同意，或者用 ❤ 说谢谢。

我希望审查者相信他们的建议不会被遗忘，所以我通过评论让他们参与其中。如果我同意他们的建议——例如进一步重构现有代码——我可能会这么说，同时也推迟在当前 PR 中进行该更改。当我在以后的 PR 中解决他们的反馈时，我会回来提供链接，让审查者知道他们的反馈没有被忽视。

我也会在后来实施建议更改的 PR 中标记他们，并附上一条说明：“这解决了 @某某 在 <之前 PR URL> 中的反馈。” 这既为其他读者提供了上下文，也向原始审查者致谢，把这个想法归功于他们。

当你兑现解决以后分支中反馈的承诺时，这有助于与你的审查者建立信任，这可以帮助他们感到舒适地批准你未来的 PR，因为他们知道你不会留下未完成的东西。
