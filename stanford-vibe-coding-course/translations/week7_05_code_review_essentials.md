# Week 7-5: Code Review Essentials for Software Teams
# 软件团队的代码审查要点 (Code Review Essentials)

> **Original Link**: [https://blakesmith.me/2015/02/09/code-review-essentials-for-software-teams.html](https://blakesmith.me/2015/02/09/code-review-essentials-for-software-teams.html)
> **Title**: Code Review Essentials for Software Teams
> **Author**: Blake Smith
> **Week**: 7
> **Reading Time**: 8 min
> **Priority**: Medium
> **Translation Date**: 2026-02-03

---

代码审查是任何协作软件项目的重要组成部分。大型软件系统通常由不止一个人编写，因此高效能的软件团队需要一个稳健的流程来保持其成员以及代码库本身朝着正确的方向发展。

代码审查是一个强大的工具，它可以：
1. 帮助团队成员在系统变化时调整他们的**心智模型 (Mental Model)**。
2. 确保变更正确解决了问题。
3. 开启关于设计优缺点的讨论。
4. 在 Bug 进入生产环境之前捕获它们。
5. 保持代码风格和组织的一致性。

将这些好处视为一个**需求层次结构**是很有帮助的。

## 保持团队成员在一起 (Keeping Team Members Together)
代码审查最关键的功能是保持团队的每个成员都朝着正确的方向前进。你无法安全地更改你不理解的系统，因此**代码审查让团队在精神上保持一致**。

当 Bob 提交会计子系统的 PR 时，Amy 在审查 Bob 的代码时会更新她对该系统的心理模型。Amy 有机会询问她不理解的部分，Bob 也有机会澄清他的设计决策，并向其他人传授他的工作。当 Amy 一个月后必须对会计子系统进行更改时，她对系统的心理模型已经是主要且准备好行动的。她花在阅读代码和试图在脑海中拼凑系统上的时间更少，而花在思考更高层次抽象和设计上的时间更多。每个人都赢了，因为每个人都保持在一起。

## 执行一个好的 Pull Request
在你写一行改变系统的代码之前，问自己以下问题：
- **“这是正确的工作吗？”** 总是会有来自客户、内部团队成员和其他方的竞争需求。在深入研究之前，这可以让你头脑中的优先事项保持清晰。
- **“团队是否已经同意这个变更是正确的？”** 如果没有，最好通过电子邮件或当面开始设计讨论。当人们在你更改之前就设计达成一致时，你的更改更有可能被接受。
- **“我怎样才能把这个变更分解成易于审查和理解的易消化块？”** 小的变更更容易思考和理解。良好的讨论源于团队能够快速理解你的变更。如果你的变更很大，队友的眼睛会变得呆滞，你可能只会从他们那里得到一些风格上的吹毛求疵。
- **“我将如何测试这个变更以消灭 bug 并确保正确性？”** 你可能有 QA 部门，但交付高质量的工作软件仍然是你作为开发者的工作。易于测试的软件通常解耦得更好，被分解成更小的块，并且更容易推理。你需要为你所有的变更制定一个测试计划。

我发现提前回答这些问题从长远来看为我省去了很多头痛。你最不想做的事情就是花几天时间编写一个变更，结果却因为基本的设计缺陷或团队分歧而被拒绝。或者你的变更因为没有人能验证其正确性而被搁置。

你宁愿用手术刀做许多小的、精确的切割，也不愿用砍刀做一个巨大的伤口。在大多数添加性案例中，我更喜欢**手术刀驱动开发**，并喜欢把砍刀留给删除大块死代码的时候。

## 发送 Pull Request
一旦你获得了团队的认可，并且实现了你想要构建的设计，实际发送 PR 的最有效方式是什么？

你的队友可能正在处理与你完全不同的事情，也许是在系统中完全不同的部分。他们的大脑处于完全不同的环境中，所以你必须通过给他们提供进行审查所需的有用指导来克服这一点。这意味着**编写一个组织良好的描述**，说明你做了什么更改，为什么要这样做，以及任何其他他们仅通过阅读代码无法获得的相关信息。不要让你的队友做超出必须做的脑力劳动。

### 坏例子：
```
Title: 修复未初始化内存 bug
Description: 这是我和 Bob 之前谈到的 bug。我在编译器上遇到了一些麻烦，但设法让它工作了。让我知道你们怎么想。
```
如果你是这个 PR 的开发者，停下来设身处地为审查者想一想。标题含糊不清，引发的问题多于答案：内存 bug 在哪里？这个变更有多关键？Bob 和你之前谈到的 bug 是什么？你在编译器上遇到了什么麻烦？描述没有提供关于问题的任何有用上下文，也没有提供关于你更改的任何有用描述。

### 改进的例子：
```
Title: 修复统计 Counter 类中未初始化内存导致的启动时进程崩溃 [#54633]
Description: 这个 bug 由于我们的统计 Counter 类中的内存初始化错误而导致启动时进程崩溃。我和 Bob 讨论过这个问题，我们都同意崩溃是一个罕见的边缘情况，不需要紧急修复发布。
以下是更改摘要：
- 将底层 int 变量移入类初始化器，以防止 Counter 中的未初始化内存。
- 重工 Counter 接口以简化调用者条件逻辑并防止进一步的 off-by-one 计数问题。
- 添加了一个暴露崩溃的单元测试。
测试：
我已经验证测试套件仍然通过，并手动验证崩溃在本地不再发生。
```
这个改进的描述中：标题具有足够的描述性。审查者知道这是一个进程崩溃（这通常是一件很糟糕的事情），还有一个 bug 报告编号。新的描述概述了问题发生的地方，并有助于提供一些关于修复有多关键的上下文。有一个摘要列出了 PR 中的高级结构更改，这将在审查者看代码之前给他们一个心理图景。还概述了已执行的测试，这将给审查者信心。

## 审查者：给予建设性反馈
审查过程的下一部分是向你的同行提供建设性反馈。如果目标是清晰和一致，给予高质量的建设性反馈有助于每个人更好地理解系统并推动更好的代码。

**避免说像这样的话：**
- “这个设计坏了。”（这会伤害信心和自尊）
- “我不喜欢这个变更。”（为什么？你想要什么替代方案？）
- “你能重写这个让它更清晰吗？”（这本身就不清楚）

**相反，说像这样的话：**
- “这段代码如何处理负整数？”（这是具体的，并促使开发者自己思考结果）
- “这一部分对我来说很困惑，我不明白为什么 A 类要和 B 类对话。”（这有助于推动设计的清晰度）
- “看起来你在这里打破了一个接口边界。这将如何影响用户？”（这指出了一个问题，同时给他们无罪推定）

一般来说，**将反馈构建为问题**是推动清晰度、正确性，同时帮助开发者在未来改进其设计的好方法。
